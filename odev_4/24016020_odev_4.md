import cv2
from matplotlib import pyplot as plt
import numpy as np

# Klasordeki bir resmi okuma, gosterme, rengini degistirme, kaydetme islemleri

resim = cv2.imread('elnino.jpg',0) #elimizdeki resmi gri(0) tonunda oku
cv2.imshow("Resim",resim) #elimizdeki resmi göster
k = cv2.waitKey(0) #klavyeden bir tusa basilana kadar resmi goster (0 milisaniye içerisinde)

if k==27: #27 ESC tusunun ASCII kodu oldugu icin ESC tusuna basildiginda asagidaki islemler gerceklesir
    print('ESC tusuna basildi ve kaydedildi.')
    cv2.imwrite('elnino_gri.jpg',resim) #yeni bir resim dosyasi kaydeder
elif k==ord('q'): #ord fonksiyonu kullanildiginda direkt olarak kodu referans aldigi icin kodun kendisini degil harfi yazmak yeterlidir.
    print("Q tusuna basildi ve cikis yapildi.")
else:
    print('ESC ve Q disindaki herhangi bir tusa basildi ve cikis yapildi.')

---------------------------------------------------------------------------------------------

#Pencere olusturma, boyutlandirma islemleri

#resim = cv2.imread('elnino.jpg') 
#cv2.namedWindow('Resim',cv2.WINDOW_AUTOSIZE) #Yeni bir pencere olusturur ve pencere boyutunu resme gore ayarlar
#cv2.namedWindow('Resim2',cv2.WINDOW_NORMAL) #Bu penceredeyse pencere boyutunu istedigimiz gibi kontrol ediyoruz.
#cv2.imshow("Resim2",resim) #Buradaysa olusturdugumuz yeni bos pencerenin icerisine resmi yerlestirir
#cv2.waitKey(0)

# Kamera ile goruntu yakalama, renk degistirme, ekranda gosterme islemleri
cam = cv2.VideoCapture(0) #kamera tanimlama islemi (0 dahili kameradir)

if not cam.isOpened(): #kameranin acilip acilmadigini kontrol eder
    print("Kamera tanimlanamadi.")
    exit()

while True:
    ret, frame = cam.read() #kameradan goruntu alma islemi

    frame = cv2.cvtColor(frame,cv2.COLOR_BGR2GRAY) #kameradan alinan goruntuyu griye cevirme islemi

    if not ret: #eger kameradan goruntu alinamadiysa donguyu bitirir
        print('Kameradan goruntu alinamadi.')
        break

    cv2.imshow('kamera',frame) #kameradan alinan goruntuyu ekranda gosterir

    if cv2.waitKey(1) & 0xFF == ord('q'): #q tusuna basildiginda dongu sonlanir
        print("Goruntu sonlandirildi.")
        break

cam.release() #kamerayi serbest birakir
cv2.destroyAllWindows()


# Bu komutlar kameranin boyutlarini duzenlemek icin kullaniliyor, her boyut ve ayarin kendine ait bir kodu var.
 cam.set(3,320) genislik
 cam.set(4,320) yukseklik

# klasördeki herhangi bir video dosyası üzerinde aynısını yapabiliriz
cam = cv2.VideoCapture('aykutelmas.mp4') 

while cam.isOpened():
    ret, frame = cam.read()
    frame = cv2.cvtColor(frame,cv2.COLOR_BGR2GRAY)
    if not ret:
        print('Goruntu Okunamadi.')
        break

    cv2.imshow('Video',frame)

    if cv2.waitKey(1) & 0xFF == ord('q'):
        print('Video bitti veya sonlandirildi.')
        break

cam.release()
cv2.destroyAllWindows()

-----------------------------------------------------------------

# Kamera ile video cekme ve kaydetme islemleri

cam = cv2.VideoCapture(0)
fourcc = cv2.VideoWriter_fourcc(*'XVID') #Video codec belirleme
out = cv2.VideoWriter('goruntum.avi',fourcc,20.0,(640,480)) #Video dosyasi olusturma ve ozellikleri (dosya ismi, codec, fps, boyutlari)

while cam.isOpened():
    ret, frame = cam.read()
    if not ret:
        print('Goruntu alinamadi.')
        break
    out.write(frame) #kameradan alinan goruntuyu video dosyasina yazdirma islemi

    cv2.imshow('Görüntü',frame)

    if cv2.waitKey(1) & 0xFF == ord('q'):
        print('Goruntu kapatildi veya cikis yapildi.')
        break

cam.release() 
out.release() 
cv2.destroyAllWindows() 

----------------------------------------------------------------

#Geometrik Sekiller cizme islemleri

image = np.zeros((512,512,3),np.uint8) #512*512 boyutunda siyah bir resim olusturduk, 3 renk uzayini ifade ediyor, np.uint8 ise ondalık degil tam sayilarla islem yapmamiz anlamina geliyor
cv2.line(image,(0,0),(511,511),(255,0,0),5) #resmin uzerine bir cizgi cektik, ilk parametre baslangıc koordinati, ikinicisi bitis koordinati, ucuncusu ise BGR (blue, green, red) seklinde renk belirlemesi, dolayisiyla rengimiz koyu mavi olacaktir. Son parametre ise kalinlik.

cv2.line(image,(0,255),(0,0),(0,0,255),5)
cv2.line(image,(0,511),(0,255),(0,255,0),5)
cv2.line(image,(0,511),(255,511),(200,123,78),5)
cv2.line(image,(255,511),(511,511),(12,123,98),5)
cv2.line(image,(511,511),(511,255),(200,123,78),5)
cv2.line(image,(511,255),(511,0),(200,123,78),5)
cv2.line(image,(511,0),(255,0),(200,123,78),5)
cv2.line(image,(255,0),(0,0),(200,123,78),5)
cv2.line(image,(0,511),(511,0),(0,255,255),5)

cv2.rectangle(image,(50,50),(300,300),(255,0,0),5)   #dikdortgen cizme islemi
cv2.rectangle(image,(100,100),(400,400),(255,0,0),-1) #-1 icerisini doldurur

cv2.circle(image,(255,255),60,(0,255,0),-1) #cember cizme islemi, ilk parametre merkez koordinatlari, ikinci parametre yaricap.

cv2.ellipse(image,(256,256),(100,50),0,0,180,(255,100,0),5) #elips cizme islemi, (merkez koor.,yaricap koor.,dondurme,baslangic,bitis acilari,renk,kalinlik)

pts = np.array([[50,50],[100,100],[50,100],[100,50]],np.int32) #cokgen cizme islemi icin nokta koordinatlarini belirledik
pts2 = pts.reshape((-1,1,2)) #cokgen cizme islemi icin nokta koordinatlarini duzenledik
cv2.polylines(image,[pts2],True,(0,255,255),3) #cokgen cizme islemi, ilk parametre nokta koordinatlari, ikinci parametre kapali olup olmadigi, ucuncusu renk, dorduncusu kalinlik

font = cv2.FONT_HERSHEY_SIMPLEX #font tipi secimi
cv2.putText(image,'YODA',(50,255),font,5,(255,255,255),3,cv2.LINE_AA) #yazi ekleme islemi, ilk parametre resim, ikinci parametre yazi metni, ucuncusu baslangic koordinatlari, dorduncusu font tipi, besincisi font boyutu, altincisi renk, yedincisi kalinlik, sekizincisi ise cizgi tipi

cv2.imshow('Goruntu',image)
cv2.waitKey(0)
cv2.destroyAllWindows()

----------------------------------------------------------------

# Paint benzeri bir uygulama yapimi

cizim = False # en basta cizim yapilmamasini belirtiyoruz
mod = False # cizim modunu belirliyoruz
xi,yi = -1,-1 # baslangic koordinatlarini belirliyoruz
def draw(event, x, y, flags, param): # cizim fonksiyonu, 1) event: fare olayi, 2) fare koordinatlari
    global cizim, xi, yi, mod # fonksiyon icerisinde bu degiskenleri kullanabilmek icin global olarak tanimliyoruz

    if event == cv2.EVENT_LBUTTONDBLCLK: # cift tiklandiginda bir daire cizdirme
        cv2.circle(image,(x,y),15,(255,255,255),2)

    if event == cv2.EVENT_LBUTTONDOWN: # sol fare tusuna basılı tutuldugunda cizimi baslatiyoruz

        xi,yi = x,y #baslangic koordinatlarini mouse'un o anki koordinatlari olarak belirliyoruz

        cizim = True #cizim basliyor

    elif event == cv2.EVENT_MOUSEMOVE: # mouse hareket ettiginde
        if cizim ==True: #cizim basladiysa
            if mod == True: 
                cv2.circle(image,(x,y),10,(100,50,0),-1) #mod true ise cember cizdirir
            else:
                cv2.rectangle(image,(xi,yi),(x,y),(0,0,255),-1) #false ise dikdortgen cizdirir
        else:
            pass

    elif event == cv2.EVENT_LBUTTONUP: # sol mouse tusu birakildiginda#
        cizim = False #cizim durur

image = np.ones((512,512,3),np.uint8) #beyaz bir resim olusturduk

cv2.namedWindow('Paint') #pencere olusturduk
cv2.setMouseCallback('Paint',draw) #fare hareketlerini izleyebilmek adina fare callback fonksiyonunu tanimladik

while(1):
    cv2.imshow('Paint',image) #pencereye resmi yerlestirdik
    if cv2.waitKey(1) & 0xFF == ord('q'): #q ya basildiginda uygulama kapanir
        break
    if cv2.waitKey(1) & 0xFF == ord('m'): #m ye basildiginda mod degisir
        mod = not mod

cv2.destroyAllWindows()

----------------------------------------------------------------

# TRACKBAR Kullanimi

def nothing(x): # trackbar icin geri cagirma fonksiyonu
    pass

image = np.zeros((512,512,3),np.uint8) #siyah bir resim olusturduk

cv2.namedWindow('Pencere') #pencere olusturduk

cv2.createTrackbar('R','Pencere',0,255,nothing) #Kirmizi icin trackbar olusturduk, 0 baslangic degeri, 255 maksimum deger
cv2.createTrackbar('G','Pencere',0,255,nothing) #Yesil icin trackbar olusturduk, 0 baslangic degeri, 255 maksimum deger
cv2.createTrackbar('B','Pencere',0,255,nothing) #Mavi icin trackbar olusturduk, 0 baslangic degeri, 255 maksimum deger
cv2.createTrackbar('Switch','Pencere',0,1,nothing) #Modu acma kapama icin trackbar olusturduk

while(1):
    cv2.imshow('Pencere',image)

    if cv2.waitKey(1) & 0xFF == ord('q'):
        break

    r = cv2.getTrackbarPos('R','Pencere') #Kirmizi degerini aliyoruz
    g = cv2.getTrackbarPos('G','Pencere') #Yesil degerini aliyoruz
    b = cv2.getTrackbarPos('B','Pencere') #Mavi degerini aliyoruz

    if cv2.getTrackbarPos('Switch','Pencere') == 0: #Switch kapali ise resmi siyah yapmasini sagliyoruz

        image[:] = 0 
    else: #Switch acik ise resmi trackbar degerlerine gore renklendirmesini sagliyoruz
        image   [:] = [b,g,r]

#cv2.destroyAllWindows()

----------------------------------------------------------------

# Resim Kirpma,Yerlestirme Islemleri
resim = cv2.imread('elnino.jpg')
px = resim[100,100] #resmin 100,100 koordinatlarindaki piksel degerini aliyoruz
print(px) #100,100 koordinatlarindaki piksel degerini verir [mavi,yesil,kirmizi] bgr seklinde

kirp = resim[100:200,100:200] # resmin 100-200 satir ve 100-200 sutunlarindaki kisimlarini kirpiyoruz
resim[200:300,400:500] = kirp #kirpilmis kisimlari resmin 200-300 satir ve 400-500 sutunlarina yerlestiriyoruz

plt.subplot(1,2,1) #ana resim grafigi (1 satir,2sutun, 1. grafik)
plt.imshow(resim)
plt.subplot(1,2,2) #kirpilmis resim grafigi (1 satir,2 sutun, 2. grafik)
plt.imshow(kirp)
plt.show()

----------------------------------------------------------------

#Piksellerde ve Resimlerde Aritmetik Islemler
x = np.uint8([250])
y = np.uint8([10])
sonuc1 = x+y #numpy kullanildiginda 260 degeri 8 bitlik alanda tutulamayacagi icin 256 ya bolumunden kalan 4 degeri verir
sonuc2 = cv2.add(x,y) #cv2 kullanildiginda 260 degeri 255 olarak sinirlandirilir (yani komple beyaz bir piksel vericekti)

resim1  = cv2.imread('birinci.jpg')
resim2  = cv2.imread('ikinci.jpg')

toplam = cv2.add(resim1,resim2) #iki resmi pikselleri bazinda toplar
toplam2 = cv2.addWeighted(resim1,0.6,resim2,0.4,0) #iki resmi belirli agirliklarda toplar, ilk resim %60, ikinci resim %40 agirlikta, 0 ise gama degeri

cv2.imshow('Toplam',toplam)
cv2.imshow('Toplam2',toplam2)
cv2.waitKey(0)
cv2.destroyAllWindows()

resim1_gray = cv2.cvtColor(resim1,cv2.COLOR_BGR2GRAY)
ret,mask = cv2.threshold(resim1_gray,10,255,cv2.THRESH_BINARY) #resmi griye cevirdikten sonra binary esikleme islemi uyguladik, 10 esik degerinin ustundeki tum pikselleri beyaza cevirdik

cv2.imshow('Maskeleme',mask)
cv2.waitKey(0)
cv2.destroyAllWindows()

Yaptıgımız maskenin tersini almak icin asagidaki islemleri yapiyoruz (piksel bazında 0 olan yerler 255, 255 olan yerler 0 olur)
x, y, z= resim1.shape #resmin boyutlarini aliyoruz (yukseklik,genislik,renk kanallari)
roi = resim1[0:x,0:y] #resim1 in istenen alanini kirptik
resim1_gray = cv2.cvtColor(resim1,cv2.COLOR_BGR2GRAY)
ret,mask = cv2.threshold(resim1_gray,10,255,cv2.THRESH_BINARY)
mask_inv = cv2.bitwise_not(mask) #maskenin tersini aliyoruz
cv2.imshow('Maskenin Tersi',mask_inv)
cv2.imshow('Maskeleme',mask)
cv2.waitKey(0)
cv2.destroyAllWindows()

----------------------------------------------------------------

Renk Uzaylari ve Renk Donusumleri
cam = cv2.VideoCapture(0)
def nothing(x):
    pass

cv2.namedWindow('frame')
cv2.createTrackbar('H1','frame',0,359,nothing)
cv2.createTrackbar('H2','frame',0,359,nothing)
cv2.createTrackbar('S1','frame',0,255,nothing)
cv2.createTrackbar('S2','frame',0,255,nothing)
cv2.createTrackbar('V1','frame',0,255,nothing)
cv2.createTrackbar('V2','frame',0,255,nothing)


while cam.isOpened():
    _, frame = cam.read()
    hsv = cv2.cvtColor(frame,cv2.COLOR_BGR2HSV) #kameradan alinan goruntuyu farkli renk uzayina cevirme islemi

    h1 = int(cv2.getTrackbarPos('H1','frame')/2)
    h2 = int(cv2.getTrackbarPos('H2','frame')/2)    
    s1 = cv2.getTrackbarPos('S1','frame')
    s2 = cv2.getTrackbarPos('S2','frame')
    v1 = cv2.getTrackbarPos('V1','frame')
    v2 = cv2.getTrackbarPos('V2','frame')   

    lower = np.array([110,50,50]) #HSV renk uzayinda alt sinir degerleri
    upper = np.array([130,255,255]) #HSV renk uzayinda ust sinir degerleri
    mask = cv2.inRange(hsv,lower,upper) #belirlenen sinirlara gore maske olusturma islemi
    res = cv2.bitwise_and(frame,frame,mask=mask) #orijinal goruntu ile maske arasinda bitwise AND islemi uygulama

    cv2.imshow('HSV Renk Uzayi',mask) #farkli renk uzayina cevrilen goruntuyu ekranda gosterir
    cv2.imshow('Kamera',frame) #kameradan alinan goruntuyu ekranda gosterir
    cv2.imshow('Sonuc',res) #islem sonucu goruntuyu ekranda gosterir

    if cv2.waitKey(5) & 0xFF == ord('q'):
        break

cam.release()
cv2.destroyAllWindows()

-----------------------------------------------------------

# HaarCascade ile yüz tanima islemi (video,fotograf)

# Haarcascade dosyalarinin icerisindeki onceden yapilmis tanimlamalar sayesinde
# kolayca yuz tanim islemi yapabiliyoruz.

image = cv2.imread('elnino.jpg')
yuz = cv2.CascadeClassifier('facedetection.xml') # Haar cascade dosyasini ekliyoruz
griton = cv2.cvtColor(image,cv2.COLOR_BGR2GRAY) # Fotografı griye cevirmek daha saglikli sonuc veriyor
yuzler = yuz.detectMultiScale(griton,1.3,2) # Tanimladigimiz dosyayla beraber yuz tanima islemini gerceklestiriyoruz (hangi video oldugu,olcek,kac tanima izin verdigimiz)
for x,y,w,h in yuzler: #yukaridaki yaptigimiz islemden koordinatlar,genislik ve yukseklik parametreleri geldi.
    cv2.rectangle(image,(x,y),(x+w,y+h),(255,0,0),1) #burada bounding box ayarliyoruz, bitis koordinatlari yuzun genisligi ve yuksekliginin bitis noktalari olarak ayarliyoruz.

cv2.imshow("Resim",image)
cv2.waitKey(0)
cv2.destroyAllWindows

# Video/kamera ile yapimi

video = cv2.VideoCapture("videoo.mp4")
yuz = cv2.CascadeClassifier('facedetection.xml')

while True:
    ret, frame = video.read()
    griton = cv2.cvtColor(frame,cv2.COLOR_BGR2GRAY)
    yuzler = yuz.detectMultiScale(griton,1.3,1)

    for x,y,w,h in yuzler:
        cv2.rectangle(frame,(x,y),(x+w,y+h),(0,0,255),3)

    cv2.imshow("pencere",frame)

    if ret == 0:
        break

    if cv2.waitKey(10) & 0xFF == ord("q"):
        break

video.release()
cv2.destroyAllWindows()

-------------------------------------------

Egitim setinde gormedigim ve lazim olan bazi komutlar

cv2.putText(goruntu,"yazi",konum,font,boyut,renk,kalinlik) #goruntu uzerine yazi ekleme.







